dist: xenial

language: go

env:
  - GO111MODULE=on

go:
  - 1.13.x

install: true

git:
  depth: 1

install:
  - go install github.com/gohugoio/hugo
  - npm install -g sass

script:
  - docker run --rm -v $(pwd):/site -w /site silex/emacs:master-alpine emacs blog.org --load org-config.el --batch -f tpanum/compile
  - rm -f themes/tpanum/static/css
  - mkdir -p themes/tpanum/static/css
  - sass --update themes/tpanum/scss:themes/tpanum/static/css --style compressed
  - hugo
  - echo panum.dk > public/CNAME

deploy:
  local_dir: public
  repo: tpanum/tpanum.github.io
  target_branch: master
  provider: pages
  skip_cleanup: true
  github_token: $GITHUB_TOKEN
  email: thomas@panum.dk
  name: "tpanum"
  on:
    branch: master
